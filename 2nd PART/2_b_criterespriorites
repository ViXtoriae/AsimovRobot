SELECT
    r.id_robot,
    r.nom_robot,
    r.modele,
    r.etat,
    IFNULL(SUM(CASE WHEN a.resultat = 'succès' THEN 1 ELSE 0 END), 0) AS succes,
    
    (r.priorite_modele * 15)
      + (IFNULL(SUM(CASE WHEN a.resultat = 'succès' THEN 1 ELSE 0 END), 0) * 3)
      + (CASE WHEN r.etat = 'actif' THEN 30 ELSE 0 END)
    AS nouveau_score

FROM robots r
LEFT JOIN actions a ON r.id_robot = a.id_robot
GROUP BY r.id_robot
ORDER BY nouveau_score DESC;
