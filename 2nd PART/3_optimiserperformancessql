
EXPLAIN
SELECT
    r.id_robot,
    r.nom_robot,
    r.etat,
    (r.priorite_modele * 10)
      + (IFNULL(SUM(CASE WHEN a.resultat = 'succès' THEN 1 ELSE 0 END), 0) * 5)
      + (CASE WHEN r.etat = 'actif' THEN 50 ELSE 0 END)
    AS score_priorite
FROM robots r
LEFT JOIN actions a ON r.id_robot = a.id_robot
GROUP BY r.id_robot;

-- Améliorer les performances
CREATE INDEX idx_actions_id_robot ON actions(id_robot);
CREATE INDEX idx_robots_etat ON robots(etat);

-- Après optimisation
EXPLAIN
SELECT
    r.id_robot,
    r.nom_robot,
    r.etat,
    (r.priorite_modele * 10)
      + (IFNULL(SUM(CASE WHEN a.resultat = 'succès' THEN 1 ELSE 0 END), 0) * 5)
      + (CASE WHEN r.etat = 'actif' THEN 50 ELSE 0 END)
    AS score_priorite
FROM robots r
LEFT JOIN actions a ON r.id_robot = a.id_robot
GROUP BY r.id_robot;
